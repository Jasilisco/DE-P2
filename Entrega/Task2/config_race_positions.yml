datasources:
  race_results:
    name: "../DATASETS/results.csv"
    base: true
  races:
    name: "../DATASETS/races.csv"
    mergeLogic:
      base: raceId
      field: raceId
  drivers:
    name: "../DATASETS/drivers.csv"
    mergeLogic:
      base: driverId
      field: driverId
  constructors:
    name: "../DATASETS/constructors.csv"
    mergeLogic:
      base: constructorId
      field: constructorId
  circuits:
    name: "../DATASETS/circuits.csv"
    mergeLogic:
      base: circuitId
      field: circuitId
    rename:
      alt: altitude
      lat: latitude
      lng: longitude
  status:
    name: "../DATASETS/status.csv"
    mergeLogic:
      base: statusId
      field: statusId

database:
  sqlScript: "./f1_race_results.sql"
  user: root
  password: admin
  host: localhost
  port: 3306
  name: f1_race_results

tables:
  dim_driver:
    driverId: { autogenerated: true }
    driver_nk: driverId
    driver_ref: driverRef
    code: code
    forename: forename
    surname: surname
    nationality: nationality
    number: number

  dim_constructor:
    constructorId: { autogenerated: true }
    constructor_nk: constructorId
    constructor_ref: constructorRef
    name: name
    country: nationality
    url: url

  dim_circuit:
    circuitId: { autogenerated: true }
    circuit_nk: circuitId
    circuit_ref: circuitRef
    name: name
    location: location
    country: country
    altitude: altitude
    latitude: latitude
    longitude: longitude

  dim_date:
    dateId: { autogenerated: true }
    date: date
    year: { value: date, date: true }
    month: { value: date, date: true }
    day: { value: date, date: true }
    day_of_week: { value: date, day: true }

  dim_race:
    raceId: { autogenerated: true }
    race_nk: raceId
    name: name
    round: round
    year: { value: date, date: true }
    url: url

  dim_status:
    statusId: { autogenerated: true }
    status_nk: statusId
    status: status

  fact_race_positions:
    race_result_id: { autogenerated: true }
    race_id: { fk: dim_race }
    driver_id: { fk: dim_driver }
    constructor_id: { fk: dim_constructor }
    circuit_id: { fk: dim_circuit }
    date_id: { fk: dim_date }
    status_id: { fk: dim_status }

    initial_position: grid
    final_position: position
    ranking_position: positionOrder
    points: points
    laps: laps

    time_str: time
    time_ms: milliseconds

    fastest_lap: fastestLap
    fastest_lap_time_str: fastestLapTime
    fastest_lap_time_ms: { value: fastestLapTime, duration: true }
    fastest_lap_top_speed: fastestLapSpeed

config:
  dim_driver:
    design:
      value: dimension
      hash:
        base: [driver_nk]
    id: driverId
    onDuplicate:
      method: ignore

  dim_constructor:
    design:
      value: dimension
      hash:
        base: [constructor_nk]
    id: constructorId
    onDuplicate:
      method: ignore

  dim_circuit:
    design:
      value: dimension
      hash:
        base: [circuit_nk]
    id: circuitId
    onDuplicate:
      method: ignore

  dim_date:
    design:
      value: dimension
      hash:
        base: [date]
    id: dateId
    onDuplicate:
      method: ignore

  dim_race:
    design:
      value: dimension
      hash:
        base: [race_nk]
    id: raceId
    onDuplicate:
      method: ignore

  dim_status:
    design:
      value: dimension
      hash:
        base: [status_nk]
    id: statusId
    onDuplicate:
      method: ignore

  fact_race_result:
    design: fact
    id: [race_id, driver_id]
    onDuplicate:
      method: ignore

    onNull:
      method: default
      criteria:
        final_position: null
        time_ms: null
        fastest_lap_time_ms: null
